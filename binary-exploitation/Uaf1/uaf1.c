#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <stdbool.h>

struct uaf {
	void (*func)();
} *uaf1 = NULL, *uaf2 = NULL;

void exec2(){
    system("cat flag.txt");
}

void exec1(){
    printf("called call1\n");
}

void make1(){
    uaf1 = malloc(sizeof(struct uaf));
    uaf1->func = exec1;
}

void make2(){
    uaf2 = malloc(sizeof(struct uaf));
    uaf2->func = exec2;
}

int main(){
    char buffer[32];

    printf("$ ");
    fflush(stdout);

    while( fgets(buffer, 32 , stdin) ){
        buffer[strcspn(buffer, "\r\n")] = 0;

        if (strcmp(buffer, "make 1") == 0){
            make1();
        } else if (strcmp(buffer, "call 1") == 0){
            uaf1->func();
        } else if (strcmp(buffer, "free 1") == 0){
            free(uaf1);
        } else if (strcmp(buffer, "make 2") == 0){
            make2();
        } else if (strcmp(buffer, "call 2") == 0){
            printf("call2 disabled\n");
        } else if (strcmp(buffer, "free 2") == 0){
            free(uaf2);
        }

        printf("$ ");
        fflush(stdout);
    }
}
